/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ElementRef, EventEmitter, Input, Output, ViewChild } from '@angular/core';
import { clearAllSelection, getFirstSelectedItem, stopPropagationAndDefault } from './utils/util';
export class DropdownListComponent {
    constructor() {
        /**
         * bind to [multiSelection], the flag for multi-select (checkbox) mode.
         */
        this.multiSelection = false;
        /**
         * bind to [filterBox] for displaying the filter input text box
         */
        this.filterBox = false;
        /**
         * bind to [allowClear] for enabling the clearance (clearance is not avaiable when checkbox is enabled)
         */
        this.allowClear = true;
        /**
         * bind to [formatNumber] for show formatted number text
         */
        this.formatNumber = false;
        /**
         * for 2-way binding of [selectedValue], using async event to
         * prevent "ExpressionChangedAfterItHasBeenCheckedError".
         */
        this.selectedValueChange = new EventEmitter(true);
        /**
         * [selectionChange] event that will be triggered when changing of the selection.
         * Using async event to prevent "ExpressionChangedAfterItHasBeenCheckedError".
         */
        this.selectionChange = new EventEmitter(true);
        /**
         * visibility flag of drop down
         */
        this.dropdownVisibility = false;
    }
    /**
     * current selected text
     * @return {?}
     */
    get selectedText() {
        if (!this.multiSelection) {
            /** @type {?} */
            const selectedItem = getFirstSelectedItem(this.items);
            return selectedItem ? selectedItem.text : undefined;
        }
    }
    /**
     * triggered with (selectionChange) event, emits (selectedValueChange) and (selectionChange)
     * @param {?} event
     * @return {?}
     */
    onSelectionChange(event) {
        this.selectedValueChange.emit(event);
        this.selectionChange.emit(event);
    }
    /**
     * triggered with (anchorClick) event, controlling the "open" and "close" of the dropdown
     * @param {?} event
     * @return {?}
     */
    onAnchorClick(event) {
        if (this.disabled) {
            stopPropagationAndDefault(event);
            return;
        }
        if (this._isSelectionOpen()) {
            this._hideItemList();
        }
        else {
            this._showItemsList();
        }
        stopPropagationAndDefault(event);
    }
    /**
     * triggered with (itemClick) event, closes the dropdown in non-checkbox mode
     * @return {?}
     */
    onItemClick() {
        if (!this.multiSelection) {
            this._hideItemList();
        }
    }
    /**
     * triggered with (clearanceClick) event, clearing all selections
     * and emits (selectedValueChange) and (selectionChange) event for empty value
     * @param {?} event
     * @return {?}
     */
    onClearanceClick(event) {
        if (!this.multiSelection) {
            this.selectedValue = void 0;
            this.selectedValueChange.emit(undefined);
            this.selectionChange.emit(undefined);
            clearAllSelection(this.items);
        }
        stopPropagationAndDefault(event);
    }
    /**
     * triggered with (dropdownBlur) event, closes the dropdown
     * @return {?}
     */
    onItemsBlur() {
        if (this._isSelectionOpen()) {
            this._hideItemList();
        }
    }
    /**
     * close the dropdown
     * @private
     * @return {?}
     */
    _hideItemList() {
        // hide the dropdown element (has some problem for using CSS directly, using this as a workaround)
        this._dropdownElement.classList.remove('visible');
        this._dropdownElement.style.display = 'none';
        this.dropdownVisibility = false;
    }
    /**
     * open the dropdown
     * @private
     * @return {?}
     */
    _showItemsList() {
        // display the dropdown element (has some problem for using CSS directly, using this as a workaround)
        this._dropdownElement.classList.add('visible');
        this._dropdownElement.style.display = 'block';
        this.dropdownVisibility = true;
        // scrolling to the selected item
        if (this._selectedElement) {
            this._selectedElement.scrollIntoView({ behavior: 'instant', block: 'center' });
        }
        // setting the focus
        if (this.filterBox && !this.multiSelection) {
            this._filterInputElement.focus();
        }
        else {
            this._dropdownElement.focus();
        }
    }
    /**
     * visibility status of dropdown
     * @private
     * @return {?}
     */
    _isSelectionOpen() {
        return this.dropdownVisibility;
    }
    /**
     * get the real dropdown element (for focusing and visibility controlling), the <span> not the <dropdown>
     * @private
     * @return {?}
     */
    get _dropdownElement() {
        return this.dropdownRef ? this.dropdownRef.nativeElement ? this.dropdownRef.nativeElement.firstElementChild : null : null;
    }
    /**
     * get the real filter element (for focusing), the <input> not the <input-filter>
     * @private
     * @return {?}
     */
    get _filterInputElement() {
        return this._dropdownElement ?
            this._dropdownElement.firstElementChild ? this._dropdownElement.firstElementChild.firstElementChild : null : null;
    }
    /**
     * get the HTMLElement of selected item, for doing (scrollIntoView) scrolling to the selected item
     * @private
     * @return {?}
     */
    get _selectedElement() {
        /** @type {?} */
        const selectedItem = getFirstSelectedItem(this.items);
        return selectedItem ? (/** @type {?} */ (document.getElementById(selectedItem.id))) : undefined;
    }
}
DropdownListComponent.decorators = [
    { type: Component, args: [{
                selector: 'ngx-dropdown-list',
                template: `
    <span class="ngx-select">
        <anchor (anchorClick)="onAnchorClick($event)" (clearanceClick)="onClearanceClick($event)"
                [checkbox]="multiSelection"
                [formatNumber]="formatNumber"
                [suffixText]="suffixText"
                [placeHolder]="placeHolder"
                [allowClear]="allowClear"
                [openStatus]="dropdownVisibility"
                [selectedText]="selectedText"
                [disabled]="disabled">
        </anchor>
        <dropdown #dropdown (dropdownBlur) = "onItemsBlur()" (selectionChange)="onSelectionChange($event)"
                [items]="items"
                [checkbox]="multiSelection"
                [filterBox]="filterBox"
                [formatNumber]="formatNumber"
                [suffixText]="suffixText"
                [(selectedValue)]="selectedValue"
                (itemClick) = "onItemClick()"
                [disabled]="disabled">
        </dropdown>
    </span>
  `,
                styles: [":host *,:host :after,:host :before{font-size:inherit;font-weight:inherit;font-family:inherit;box-sizing:inherit;background:inherit}:host .ngx-select{border-radius:4px;font-size:14px;position:relative;display:inline-block;width:100%;height:34px;background:#fff;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}"]
            }] }
];
DropdownListComponent.propDecorators = {
    dropdownRef: [{ type: ViewChild, args: ['dropdown', { read: ElementRef },] }],
    placeHolder: [{ type: Input }],
    items: [{ type: Input }],
    multiSelection: [{ type: Input }],
    selectedValue: [{ type: Input }],
    filterBox: [{ type: Input }],
    suffixText: [{ type: Input }],
    disabled: [{ type: Input }],
    allowClear: [{ type: Input }],
    formatNumber: [{ type: Input }],
    selectedValueChange: [{ type: Output }],
    selectionChange: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    DropdownListComponent.prototype.dropdownRef;
    /**
     * bind to [placeHolder] for displaying the place holder string of the anchor.
     * @type {?}
     */
    DropdownListComponent.prototype.placeHolder;
    /**
     * bind to [items] for the options/groups in the dropdown
     * @type {?}
     */
    DropdownListComponent.prototype.items;
    /**
     * bind to [multiSelection], the flag for multi-select (checkbox) mode.
     * @type {?}
     */
    DropdownListComponent.prototype.multiSelection;
    /**
     * bind to [selectedValue] for the value of the selected option from dropdown
     * @type {?}
     */
    DropdownListComponent.prototype.selectedValue;
    /**
     * bind to [filterBox] for displaying the filter input text box
     * @type {?}
     */
    DropdownListComponent.prototype.filterBox;
    /**
     * bind to [suffixText] for displaying the suffix of the selected text of anchor
     * @type {?}
     */
    DropdownListComponent.prototype.suffixText;
    /**
     * bind to [disabled] for disabling the dropdown
     * @type {?}
     */
    DropdownListComponent.prototype.disabled;
    /**
     * bind to [allowClear] for enabling the clearance (clearance is not avaiable when checkbox is enabled)
     * @type {?}
     */
    DropdownListComponent.prototype.allowClear;
    /**
     * bind to [formatNumber] for show formatted number text
     * @type {?}
     */
    DropdownListComponent.prototype.formatNumber;
    /**
     * for 2-way binding of [selectedValue], using async event to
     * prevent "ExpressionChangedAfterItHasBeenCheckedError".
     * @type {?}
     */
    DropdownListComponent.prototype.selectedValueChange;
    /**
     * [selectionChange] event that will be triggered when changing of the selection.
     * Using async event to prevent "ExpressionChangedAfterItHasBeenCheckedError".
     * @type {?}
     */
    DropdownListComponent.prototype.selectionChange;
    /**
     * visibility flag of drop down
     * @type {?}
     */
    DropdownListComponent.prototype.dropdownVisibility;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJvcGRvd24tbGlzdC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZ3gtZHJvcGRvd24tbGlzdC8iLCJzb3VyY2VzIjpbInNyYy9uZ3gtZHJvcGRvd24tbGlzdC9kcm9wZG93bi1saXN0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFDLFNBQVMsRUFBRSxVQUFVLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBQzVGLE9BQU8sRUFBQyxpQkFBaUIsRUFBRSxvQkFBb0IsRUFBRSx5QkFBeUIsRUFBQyxNQUFNLGNBQWMsQ0FBQztBQStCaEcsTUFBTSxPQUFPLHFCQUFxQjtJQTdCbEM7Ozs7UUEyQ1csbUJBQWMsR0FBRyxLQUFLLENBQUM7Ozs7UUFRdkIsY0FBUyxHQUFHLEtBQUssQ0FBQzs7OztRQVlsQixlQUFVLEdBQUcsSUFBSSxDQUFDOzs7O1FBSWxCLGlCQUFZLEdBQUcsS0FBSyxDQUFDOzs7OztRQUtwQix3QkFBbUIsR0FBRyxJQUFJLFlBQVksQ0FBUyxJQUFJLENBQUMsQ0FBQzs7Ozs7UUFLckQsb0JBQWUsR0FBRyxJQUFJLFlBQVksQ0FBTSxJQUFJLENBQUMsQ0FBQzs7OztRQUt4RCx1QkFBa0IsR0FBRyxLQUFLLENBQUM7SUFrSTdCLENBQUM7Ozs7O0lBN0hDLElBQUksWUFBWTtRQUNkLElBQUksQ0FBQyxJQUFJLENBQUMsY0FBYyxFQUFFOztrQkFDbEIsWUFBWSxHQUFHLG9CQUFvQixDQUFDLElBQUksQ0FBQyxLQUFLLENBQUM7WUFDckQsT0FBTyxZQUFZLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztTQUNyRDtJQUNILENBQUM7Ozs7OztJQUtELGlCQUFpQixDQUFDLEtBQUs7UUFDckIsSUFBSSxDQUFDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FB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IHtDb21wb25lbnQsIEVsZW1lbnRSZWYsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE91dHB1dCwgVmlld0NoaWxkfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7Y2xlYXJBbGxTZWxlY3Rpb24sIGdldEZpcnN0U2VsZWN0ZWRJdGVtLCBzdG9wUHJvcGFnYXRpb25BbmREZWZhdWx0fSBmcm9tICcuL3V0aWxzL3V0aWwnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICduZ3gtZHJvcGRvd24tbGlzdCcsXG4gIHRlbXBsYXRlOiBgXG4gICAgPHNwYW4gY2xhc3M9XCJuZ3gtc2VsZWN0XCI+XG4gICAgICAgIDxhbmNob3IgKGFuY2hvckNsaWNrKT1cIm9uQW5jaG9yQ2xpY2soJGV2ZW50KVwiIChjbGVhcmFuY2VDbGljayk9XCJvbkNsZWFyYW5jZUNsaWNrKCRldmVudClcIlxuICAgICAgICAgICAgICAgIFtjaGVja2JveF09XCJtdWx0aVNlbGVjdGlvblwiXG4gICAgICAgICAgICAgICAgW2Zvcm1hdE51bWJlcl09XCJmb3JtYXROdW1iZXJcIlxuICAgICAgICAgICAgICAgIFtzdWZmaXhUZXh0XT1cInN1ZmZpeFRleHRcIlxuICAgICAgICAgICAgICAgIFtwbGFjZUhvbGRlcl09XCJwbGFjZUhvbGRlclwiXG4gICAgICAgICAgICAgICAgW2FsbG93Q2xlYXJdPVwiYWxsb3dDbGVhclwiXG4gICAgICAgICAgICAgICAgW29wZW5TdGF0dXNdPVwiZHJvcGRvd25WaXNpYmlsaXR5XCJcbiAgICAgICAgICAgICAgICBbc2VsZWN0ZWRUZXh0XT1cInNlbGVjdGVkVGV4dFwiXG4gICAgICAgICAgICAgICAgW2Rpc2FibGVkXT1cImRpc2FibGVkXCI+XG4gICAgICAgIDwvYW5jaG9yPlxuICAgICAgICA8ZHJvcGRvd24gI2Ryb3Bkb3duIChkcm9wZG93bkJsdXIpID0gXCJvbkl0ZW1zQmx1cigpXCIgKHNlbGVjdGlvbkNoYW5nZSk9XCJvblNlbGVjdGlvbkNoYW5nZSgkZXZlbnQpXCJcbiAgICAgICAgICAgICAgICBbaXRlbXNdPVwiaXRlbXNcIlxuICAgICAgICAgICAgICAgIFtjaGVja2JveF09XCJtdWx0aVNlbGVjdGlvblwiXG4gICAgICAgICAgICAgICAgW2ZpbHRlckJveF09XCJmaWx0ZXJCb3hcIlxuICAgICAgICAgICAgICAgIFtmb3JtYXROdW1iZXJdPVwiZm9ybWF0TnVtYmVyXCJcbiAgICAgICAgICAgICAgICBbc3VmZml4VGV4dF09XCJzdWZmaXhUZXh0XCJcbiAgICAgICAgICAgICAgICBbKHNlbGVjdGVkVmFsdWUpXT1cInNlbGVjdGVkVmFsdWVcIlxuICAgICAgICAgICAgICAgIChpdGVtQ2xpY2spID0gXCJvbkl0ZW1DbGljaygpXCJcbiAgICAgICAgICAgICAgICBbZGlzYWJsZWRdPVwiZGlzYWJsZWRcIj5cbiAgICAgICAgPC9kcm9wZG93bj5cbiAgICA8L3NwYW4+XG4gIGAsXG4gIHN0eWxlVXJsczogWycuL2Ryb3Bkb3duLWxpc3QuY29tcG9uZW50LnNjc3MnXSxcbn0pXG5cbmV4cG9ydCBjbGFzcyBEcm9wZG93bkxpc3RDb21wb25lbnQge1xuICBAVmlld0NoaWxkKCdkcm9wZG93bicsIHsgcmVhZDogRWxlbWVudFJlZiB9KSBkcm9wZG93blJlZjogRWxlbWVudFJlZjtcblxuICAvKipcbiAgICogYmluZCB0byBbcGxhY2VIb2xkZXJdIGZvciBkaXNwbGF5aW5nIHRoZSBwbGFjZSBob2xkZXIgc3RyaW5nIG9mIHRoZSBhbmNob3IuXG4gICAqL1xuICBASW5wdXQoKSBwbGFjZUhvbGRlcjogc3RyaW5nO1xuICAvKipcbiAgICogYmluZCB0byBbaXRlbXNdIGZvciB0aGUgb3B0aW9ucy9ncm91cHMgaW4gdGhlIGRyb3Bkb3duXG4gICAqL1xuICBASW5wdXQoKSBpdGVtczogYW55W107XG4gIC8qKlxuICAgKiBiaW5kIHRvIFttdWx0aVNlbGVjdGlvbl0sIHRoZSBmbGFnIGZvciBtdWx0aS1zZWxlY3QgKGNoZWNrYm94KSBtb2RlLlxuICAgKi9cbiAgQElucHV0KCkgbXVsdGlTZWxlY3Rpb24gPSBmYWxzZTtcbiAgLyoqXG4gICAqIGJpbmQgdG8gW3NlbGVjdGVkVmFsdWVdIGZvciB0aGUgdmFsdWUgb2YgdGhlIHNlbGVjdGVkIG9wdGlvbiBmcm9tIGRyb3Bkb3duXG4gICAqL1xuICBASW5wdXQoKSBzZWxlY3RlZFZhbHVlOiBhbnk7XG4gIC8qKlxuICAgKiBiaW5kIHRvIFtmaWx0ZXJCb3hdIGZvciBkaXNwbGF5aW5nIHRoZSBmaWx0ZXIgaW5wdXQgdGV4dCBib3hcbiAgICovXG4gIEBJbnB1dCgpIGZpbHRlckJveCA9IGZhbHNlO1xuICAvKipcbiAgICogYmluZCB0byBbc3VmZml4VGV4dF0gZm9yIGRpc3BsYXlpbmcgdGhlIHN1ZmZpeCBvZiB0aGUgc2VsZWN0ZWQgdGV4dCBvZiBhbmNob3JcbiAgICovXG4gIEBJbnB1dCgpIHN1ZmZpeFRleHQ6IHN0cmluZztcbiAgLyoqXG4gICAqIGJpbmQgdG8gW2Rpc2FibGVkXSBmb3IgZGlzYWJsaW5nIHRoZSBkcm9wZG93blxuICAgKi9cbiAgQElucHV0KCkgZGlzYWJsZWQ6IGJvb2xlYW47XG4gIC8qKlxuICAgKiBiaW5kIHRvIFthbGxvd0NsZWFyXSBmb3IgZW5hYmxpbmcgdGhlIGNsZWFyYW5jZSAoY2xlYXJhbmNlIGlzIG5vdCBhdmFpYWJsZSB3aGVuIGNoZWNrYm94IGlzIGVuYWJsZWQpXG4gICAqL1xuICBASW5wdXQoKSBhbGxvd0NsZWFyID0gdHJ1ZTtcbiAgLyoqXG4gICAqIGJpbmQgdG8gW2Zvcm1hdE51bWJlcl0gZm9yIHNob3cgZm9ybWF0dGVkIG51bWJlciB0ZXh0XG4gICAqL1xuICBASW5wdXQoKSBmb3JtYXROdW1iZXIgPSBmYWxzZTtcbiAgLyoqXG4gICAqIGZvciAyLXdheSBiaW5kaW5nIG9mIFtzZWxlY3RlZFZhbHVlXSwgdXNpbmcgYXN5bmMgZXZlbnQgdG9cbiAgICogcHJldmVudCBcIkV4cHJlc3Npb25DaGFuZ2VkQWZ0ZXJJdEhhc0JlZW5DaGVja2VkRXJyb3JcIi5cbiAgICovXG4gIEBPdXRwdXQoKSBzZWxlY3RlZFZhbHVlQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcjxzdHJpbmc+KHRydWUpO1xuICAvKipcbiAgICogW3NlbGVjdGlvbkNoYW5nZV0gZXZlbnQgdGhhdCB3aWxsIGJlIHRyaWdnZXJlZCB3aGVuIGNoYW5naW5nIG9mIHRoZSBzZWxlY3Rpb24uXG4gICAqIFVzaW5nIGFzeW5jIGV2ZW50IHRvIHByZXZlbnQgXCJFeHByZXNzaW9uQ2hhbmdlZEFmdGVySXRIYXNCZWVuQ2hlY2tlZEVycm9yXCIuXG4gICAqL1xuICBAT3V0cHV0KCkgc2VsZWN0aW9uQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KHRydWUpO1xuXG4gIC8qKlxuICAgKiB2aXNpYmlsaXR5IGZsYWcgb2YgZHJvcCBkb3duXG4gICAqL1xuICBkcm9wZG93blZpc2liaWxpdHkgPSBmYWxzZTtcblxuICAvKipcbiAgICogY3VycmVudCBzZWxlY3RlZCB0ZXh0XG4gICAqL1xuICBnZXQgc2VsZWN0ZWRUZXh0KCk6IGFueSB7XG4gICAgaWYgKCF0aGlzLm11bHRpU2VsZWN0aW9uKSB7XG4gICAgICBjb25zdCBzZWxlY3RlZEl0ZW0gPSBnZXRGaXJzdFNlbGVjdGVkSXRlbSh0aGlzLml0ZW1zKTtcbiAgICAgIHJldHVybiBzZWxlY3RlZEl0ZW0gPyBzZWxlY3RlZEl0ZW0udGV4dCA6IHVuZGVmaW5lZDtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogdHJpZ2dlcmVkIHdpdGggKHNlbGVjdGlvbkNoYW5nZSkgZXZlbnQsIGVtaXRzIChzZWxlY3RlZFZhbHVlQ2hhbmdlKSBhbmQgKHNlbGVjdGlvbkNoYW5nZSlcbiAgICovXG4gIG9uU2VsZWN0aW9uQ2hhbmdlKGV2ZW50KSB7XG4gICAgdGhpcy5zZWxlY3RlZFZhbHVlQ2hhbmdlLmVtaXQoZXZlbnQpO1xuICAgIHRoaXMuc2VsZWN0aW9uQ2hhbmdlLmVtaXQoZXZlbnQpO1xuICB9XG5cbiAgLyoqXG4gICAqIHRyaWdnZXJlZCB3aXRoIChhbmNob3JDbGljaykgZXZlbnQsIGNvbnRyb2xsaW5nIHRoZSBcIm9wZW5cIiBhbmQgXCJjbG9zZVwiIG9mIHRoZSBkcm9wZG93blxuICAgKi9cbiAgb25BbmNob3JDbGljayhldmVudDogRXZlbnQpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5kaXNhYmxlZCkge1xuICAgICAgc3RvcFByb3BhZ2F0aW9uQW5kRGVmYXVsdChldmVudCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICh0aGlzLl9pc1NlbGVjdGlvbk9wZW4oKSkge1xuICAgICAgdGhpcy5faGlkZUl0ZW1MaXN0KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX3Nob3dJdGVtc0xpc3QoKTtcbiAgICB9XG4gICAgc3RvcFByb3BhZ2F0aW9uQW5kRGVmYXVsdChldmVudCk7XG4gIH1cblxuICAvKipcbiAgICogdHJpZ2dlcmVkIHdpdGggKGl0ZW1DbGljaykgZXZlbnQsIGNsb3NlcyB0aGUgZHJvcGRvd24gaW4gbm9uLWNoZWNrYm94IG1vZGVcbiAgICovXG4gIG9uSXRlbUNsaWNrKCk6IHZvaWQge1xuICAgIGlmICghdGhpcy5tdWx0aVNlbGVjdGlvbikge1xuICAgICAgdGhpcy5faGlkZUl0ZW1MaXN0KCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIHRyaWdnZXJlZCB3aXRoIChjbGVhcmFuY2VDbGljaykgZXZlbnQsIGNsZWFyaW5nIGFsbCBzZWxlY3Rpb25zXG4gICAqIGFuZCBlbWl0cyAoc2VsZWN0ZWRWYWx1ZUNoYW5nZSkgYW5kIChzZWxlY3Rpb25DaGFuZ2UpIGV2ZW50IGZvciBlbXB0eSB2YWx1ZVxuICAgKi9cbiAgb25DbGVhcmFuY2VDbGljayhldmVudDogRXZlbnQpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMubXVsdGlTZWxlY3Rpb24pIHtcbiAgICAgIHRoaXMuc2VsZWN0ZWRWYWx1ZSA9IHZvaWQgMDtcbiAgICAgIHRoaXMuc2VsZWN0ZWRWYWx1ZUNoYW5nZS5lbWl0KHVuZGVmaW5lZCk7XG4gICAgICB0aGlzLnNlbGVjdGlvbkNoYW5nZS5lbWl0KHVuZGVmaW5lZCk7XG4gICAgICBjbGVhckFsbFNlbGVjdGlvbih0aGlzLml0ZW1zKTtcbiAgICB9XG4gICAgc3RvcFByb3BhZ2F0aW9uQW5kRGVmYXVsdChldmVudCk7XG4gIH1cblxuICAvKipcbiAgICogdHJpZ2dlcmVkIHdpdGggKGRyb3Bkb3duQmx1cikgZXZlbnQsIGNsb3NlcyB0aGUgZHJvcGRvd25cbiAgICovXG4gIG9uSXRlbXNCbHVyKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLl9pc1NlbGVjdGlvbk9wZW4oKSkge1xuICAgICAgdGhpcy5faGlkZUl0ZW1MaXN0KCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIGNsb3NlIHRoZSBkcm9wZG93blxuICAgKi9cbiAgcHJpdmF0ZSBfaGlkZUl0ZW1MaXN0KCk6IHZvaWQge1xuICAgIC8vIGhpZGUgdGhlIGRyb3Bkb3duIGVsZW1lbnQgKGhhcyBzb21lIHByb2JsZW0gZm9yIHVzaW5nIENTUyBkaXJlY3RseSwgdXNpbmcgdGhpcyBhcyBhIHdvcmthcm91bmQpXG4gICAgdGhpcy5fZHJvcGRvd25FbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3Zpc2libGUnKTtcbiAgICB0aGlzLl9kcm9wZG93bkVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICB0aGlzLmRyb3Bkb3duVmlzaWJpbGl0eSA9IGZhbHNlO1xuICB9XG5cbiAgLyoqXG4gICAqIG9wZW4gdGhlIGRyb3Bkb3duXG4gICAqL1xuICBwcml2YXRlIF9zaG93SXRlbXNMaXN0KCk6IHZvaWQge1xuICAgIC8vIGRpc3BsYXkgdGhlIGRyb3Bkb3duIGVsZW1lbnQgKGhhcyBzb21lIHByb2JsZW0gZm9yIHVzaW5nIENTUyBkaXJlY3RseSwgdXNpbmcgdGhpcyBhcyBhIHdvcmthcm91bmQpXG4gICAgdGhpcy5fZHJvcGRvd25FbGVtZW50LmNsYXNzTGlzdC5hZGQoJ3Zpc2libGUnKTtcbiAgICB0aGlzLl9kcm9wZG93bkVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XG5cbiAgICB0aGlzLmRyb3Bkb3duVmlzaWJpbGl0eSA9IHRydWU7XG5cbiAgICAvLyBzY3JvbGxpbmcgdG8gdGhlIHNlbGVjdGVkIGl0ZW1cbiAgICBpZiAodGhpcy5fc2VsZWN0ZWRFbGVtZW50KSB7XG4gICAgICB0aGlzLl9zZWxlY3RlZEVsZW1lbnQuc2Nyb2xsSW50b1ZpZXcoeyBiZWhhdmlvcjogJ2luc3RhbnQnLCBibG9jazogJ2NlbnRlcicgfSk7XG4gICAgfVxuXG4gICAgLy8gc2V0dGluZyB0aGUgZm9jdXNcbiAgICBpZiAodGhpcy5maWx0ZXJCb3ggJiYgIXRoaXMubXVsdGlTZWxlY3Rpb24pIHtcbiAgICAgIHRoaXMuX2ZpbHRlcklucHV0RWxlbWVudC5mb2N1cygpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9kcm9wZG93bkVsZW1lbnQuZm9jdXMoKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogdmlzaWJpbGl0eSBzdGF0dXMgb2YgZHJvcGRvd25cbiAgICovXG4gIHByaXZhdGUgX2lzU2VsZWN0aW9uT3BlbigpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5kcm9wZG93blZpc2liaWxpdHk7XG4gIH1cblxuICAvKipcbiAgICogZ2V0IHRoZSByZWFsIGRyb3Bkb3duIGVsZW1lbnQgKGZvciBmb2N1c2luZyBhbmQgdmlzaWJpbGl0eSBjb250cm9sbGluZyksIHRoZSA8c3Bhbj4gbm90IHRoZSA8ZHJvcGRvd24+XG4gICAqL1xuICBwcml2YXRlIGdldCBfZHJvcGRvd25FbGVtZW50KCk6IGFueSB7XG4gICAgcmV0dXJuIHRoaXMuZHJvcGRvd25SZWYgPyB0aGlzLmRyb3Bkb3duUmVmLm5hdGl2ZUVsZW1lbnQgPyB0aGlzLmRyb3Bkb3duUmVmLm5hdGl2ZUVsZW1lbnQuZmlyc3RFbGVtZW50Q2hpbGQgOiBudWxsIDogbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBnZXQgdGhlIHJlYWwgZmlsdGVyIGVsZW1lbnQgKGZvciBmb2N1c2luZyksIHRoZSA8aW5wdXQ+IG5vdCB0aGUgPGlucHV0LWZpbHRlcj5cbiAgICovXG4gIHByaXZhdGUgZ2V0IF9maWx0ZXJJbnB1dEVsZW1lbnQoKTogYW55IHtcbiAgICByZXR1cm4gdGhpcy5fZHJvcGRvd25FbGVtZW50ID9cbiAgICAgIHRoaXMuX2Ryb3Bkb3duRWxlbWVudC5maXJzdEVsZW1lbnRDaGlsZCA/IHRoaXMuX2Ryb3Bkb3duRWxlbWVudC5maXJzdEVsZW1lbnRDaGlsZC5maXJzdEVsZW1lbnRDaGlsZCA6IG51bGwgOiBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIGdldCB0aGUgSFRNTEVsZW1lbnQgb2Ygc2VsZWN0ZWQgaXRlbSwgZm9yIGRvaW5nIChzY3JvbGxJbnRvVmlldykgc2Nyb2xsaW5nIHRvIHRoZSBzZWxlY3RlZCBpdGVtXG4gICAqL1xuICBwcml2YXRlIGdldCBfc2VsZWN0ZWRFbGVtZW50KCk6IEhUTUxFbGVtZW50IHtcbiAgICBjb25zdCBzZWxlY3RlZEl0ZW0gPSBnZXRGaXJzdFNlbGVjdGVkSXRlbSh0aGlzLml0ZW1zKTtcbiAgICByZXR1cm4gc2VsZWN0ZWRJdGVtID8gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoc2VsZWN0ZWRJdGVtLmlkKSBhcyBIVE1MRWxlbWVudCA6IHVuZGVmaW5lZDtcbiAgfVxufVxuIl19