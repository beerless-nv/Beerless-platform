import {Injectable} from '@angular/core';
import {HttpClient, HttpHeaders} from '@angular/common/http';
import {BehaviorSubject, Observable} from 'rxjs';
import {Guid} from 'guid-typescript';

@Injectable({
    providedIn: 'root'
})
export class ChatbotService {

    readonly apiUrl = 'https://api.oswald.ai/api/v1';
    readonly chatbotId = '5c909b61ccc52e00050a6e76';
    readonly accessToken = 'A4oA1hOSefxeOveUe49pBajyykPMhn6vFfnLG9geu4LKTGXUoDaHME9sSN4Tr0gT';
    session = null;
    messages = new BehaviorSubject<Array<any>>(null);
    messagesArray = [];

    intervalId: number;

    emojis = {
        'ðŸº': ':beer:',
        'ðŸ»': ':cheers:',
        'ðŸ˜€': ':D',
        'ðŸ˜': '',
        'ðŸ˜‚': ':\'D',
        'ðŸ™‚': ':)',
        'ðŸ˜ƒ': '',
        'ðŸ¤”': ':thinking:',
        'ðŸ˜„': '',
        'ðŸ˜…': ':\')',
        'ðŸ˜†': 'xD',
        'ðŸ˜‡': 'O:-)',
        'ðŸ˜ˆ': '>:-)',
        'ðŸ‘¿': '',
        'ðŸ˜‰': ';)',
        'ðŸ˜Š': '',
        'ðŸ˜‹': ':q',
        'ðŸ˜Œ': '',
        'ðŸ˜': '',
        'ðŸ˜Ž': 'B)',
        'ðŸ˜': '',
        'ðŸ˜': ':|',
        'ðŸ˜‘': '-_-',
        'ðŸ˜’': '',
        'ðŸ˜“': '',
        'ðŸ˜”': '',
        'ðŸ˜•': ':/',
        'ðŸ˜–': ':s',
        'ðŸ˜—': '',
        'ðŸ˜˜': ';*',
        'ðŸ˜™': ':*',
        'ðŸ˜š': '',
        'ðŸ˜›': ':p',
        'ðŸ˜œ': ';p',
        'ðŸ˜': '',
        'ðŸ˜ž': '',
        'ðŸ˜Ÿ': '',
        'ðŸ˜ ': '',
        'ðŸ˜¡': ':boos:',
        'ðŸ˜¢': ':\'(',
        'ðŸ˜£': '',
        'ðŸ˜¤': '',
        'ðŸ˜¥': '',
        'ðŸ˜¦': '',
        'ðŸ˜§': '',
        'ðŸ˜¨': '',
        'ðŸ˜©': '',
        'ðŸ˜ª': '',
        'ðŸ˜«': '',
        'ðŸ˜¬': '',
        'ðŸ˜­': '',
        'ðŸ˜®': ':o',
        'ðŸ˜¯': '',
        'ðŸ˜°': '',
        'ðŸ˜±': '',
        'ðŸ˜²': '',
        'ðŸ˜³': '',
        'ðŸ˜´': '',
        'ðŸ˜µ': '',
        'ðŸ˜¶': '',
        'ðŸ˜·': '',
        'ðŸ˜¸': '',
        'ðŸ˜¹': '',
        'ðŸ˜º': '',
        'ðŸ˜»': '',
        'ðŸ˜¼': '',
        'ðŸ˜½': '',
        'ðŸ˜¾': '',
        'ðŸ˜¿': '',
        'ðŸ™€': '',
        'ðŸ‘£': '',
        'ðŸ‘¤': '',
        'ðŸ‘¥': '',
        'ðŸ‘¶': '',
        'ðŸ‘¶ðŸ»': '',
        'ðŸ‘¶ðŸ¼': '',
        'ðŸ‘¶ðŸ½': '',
        'ðŸ‘¶ðŸ¾': '',
        'ðŸ‘¶ðŸ¿': '',
        'ðŸ‘¦': '',
        'ðŸ‘¦ðŸ»': '',
        'ðŸ‘¦ðŸ¼': '',
        'ðŸ‘¦ðŸ½': '',
        'ðŸ‘¦ðŸ¾': '',
        'ðŸ‘¦ðŸ¿': '',
        'ðŸ‘§': '',
        'ðŸ‘§ðŸ»': '',
        'ðŸ‘§ðŸ¼': '',
        'ðŸ‘§ðŸ½': '',
        'ðŸ‘§ðŸ¾': '',
        'ðŸ‘§ðŸ¿': '',
        'ðŸ‘¨': '',
        'ðŸ‘¨ðŸ»': '',
        'ðŸ‘¨ðŸ¼': '',
        'ðŸ‘¨ðŸ½': '',
        'ðŸ‘¨ðŸ¾': '',
        'ðŸ‘¨ðŸ¿': '',
        'ðŸ‘©': '',
        'ðŸ‘©ðŸ»': '',
        'ðŸ‘©ðŸ¼': '',
        'ðŸ‘©ðŸ½': '',
        'ðŸ‘©ðŸ¾': '',
        'ðŸ‘©ðŸ¿': '',
        'ðŸ‘ª': '',
        'ðŸ‘¨â€ðŸ‘©â€ðŸ‘§': '',
        'ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦': '',
        'ðŸ‘¨â€ðŸ‘©â€ðŸ‘¦â€ðŸ‘¦': '',
        'ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘§': '',
        'ðŸ‘©â€ðŸ‘©â€ðŸ‘¦': '',
        'ðŸ‘©â€ðŸ‘©â€ðŸ‘§': '',
        'ðŸ‘©â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦': '',
        'ðŸ‘©â€ðŸ‘©â€ðŸ‘¦â€ðŸ‘¦': '',
        'ðŸ‘©â€ðŸ‘©â€ðŸ‘§â€ðŸ‘§': '',
        'ðŸ‘¨â€ðŸ‘¨â€ðŸ‘¦': '',
        'ðŸ‘¨â€ðŸ‘¨â€ðŸ‘§': '',
        'ðŸ‘¨â€ðŸ‘¨â€ðŸ‘§â€ðŸ‘¦': '',
        'ðŸ‘¨â€ðŸ‘¨â€ðŸ‘¦â€ðŸ‘¦': '',
        'ðŸ‘¨â€ðŸ‘¨â€ðŸ‘§â€ðŸ‘§': '',
        'ðŸ‘«': '',
        'ðŸ‘¬': '',
        'ðŸ‘­': '',
        'ðŸ‘¯': '',
        'ðŸ‘°': '',
        'ðŸ‘°ðŸ»': '',
        'ðŸ‘°ðŸ¼': '',
        'ðŸ‘°ðŸ½': '',
        'ðŸ‘°ðŸ¾': '',
        'ðŸ‘°ðŸ¿': '',
        'ðŸ‘±': '',
        'ðŸ‘±ðŸ»': '',
        'ðŸ‘±ðŸ¼': '',
        'ðŸ‘±ðŸ½': '',
        'ðŸ‘±ðŸ¾': '',
        'ðŸ‘±ðŸ¿': '',
        'ðŸ‘²': '',
        'ðŸ‘²ðŸ»': '',
        'ðŸ‘²ðŸ¼': '',
        'ðŸ‘²ðŸ½': '',
        'ðŸ‘²ðŸ¾': '',
        'ðŸ‘²ðŸ¿': '',
        'ðŸ‘³': '',
        'ðŸ‘³ðŸ»': '',
        'ðŸ‘³ðŸ¼': '',
        'ðŸ‘³ðŸ½': '',
        'ðŸ‘³ðŸ¾': '',
        'ðŸ‘³ðŸ¿': '',
        'ðŸ‘´': '',
        'ðŸ‘´ðŸ»': '',
        'ðŸ‘´ðŸ¼': '',
        'ðŸ‘´ðŸ½': '',
        'ðŸ‘´ðŸ¾': '',
        'ðŸ‘´ðŸ¿': '',
        'ðŸ‘µ': '',
        'ðŸ‘µðŸ»': '',
        'ðŸ‘µðŸ¼': '',
        'ðŸ‘µðŸ½': '',
        'ðŸ‘µðŸ¾': '',
        'ðŸ‘µðŸ¿': '',
        'ðŸ‘®': '',
        'ðŸ‘®ðŸ»': '',
        'ðŸ‘®ðŸ¼': '',
        'ðŸ‘®ðŸ½': '',
        'ðŸ‘®ðŸ¾': '',
        'ðŸ‘®ðŸ¿': '',
        'ðŸ‘·': '',
        'ðŸ‘·ðŸ»': '',
        'ðŸ‘·ðŸ¼': '',
        'ðŸ‘·ðŸ½': '',
        'ðŸ‘·ðŸ¾': '',
        'ðŸ‘·ðŸ¿': '',
        'ðŸ‘¸': '',
        'ðŸ‘¸ðŸ»': '',
        'ðŸ‘¸ðŸ¼': '',
        'ðŸ‘¸ðŸ½': '',
        'ðŸ‘¸ðŸ¾': '',
        'ðŸ‘¸ðŸ¿': '',
        'ðŸ’‚': '',
        'ðŸ’‚ðŸ»': '',
        'ðŸ’‚ðŸ¼': '',
        'ðŸ’‚ðŸ½': '',
        'ðŸ’‚ðŸ¾': '',
        'ðŸ’‚ðŸ¿': '',
        'ðŸ‘¼': '',
        'ðŸ‘¼ðŸ»': '',
        'ðŸ‘¼ðŸ¼': '',
        'ðŸ‘¼ðŸ½': '',
        'ðŸ‘¼ðŸ¾': '',
        'ðŸ‘¼ðŸ¿': '',
        'ðŸŽ…': '',
        'ðŸŽ…ðŸ»': '',
        'ðŸŽ…ðŸ¼': '',
        'ðŸŽ…ðŸ½': '',
        'ðŸŽ…ðŸ¾': '',
        'ðŸŽ…ðŸ¿': '',
        'ðŸ‘»': '',
        'ðŸ‘¹': '',
        'ðŸ‘º': '',
        'ðŸ’©': '',
        'ðŸ’€': '',
        'ðŸ‘½': '',
        'ðŸ‘¾': '',
        'ðŸ™‡': '',
        'ðŸ™‡ðŸ»': '',
        'ðŸ™‡ðŸ¼': '',
        'ðŸ™‡ðŸ½': '',
        'ðŸ™‡ðŸ¾': '',
        'ðŸ™‡ðŸ¿': '',
        'ðŸ’': '',
        'ðŸ’ðŸ»': '',
        'ðŸ’ðŸ¼': '',
        'ðŸ’ðŸ½': '',
        'ðŸ’ðŸ¾': '',
        'ðŸ’ðŸ¿': '',
        'ðŸ™…': '',
        'ðŸ™…ðŸ»': '',
        'ðŸ™…ðŸ¼': '',
        'ðŸ™…ðŸ½': '',
        'ðŸ™…ðŸ¾': '',
        'ðŸ™…ðŸ¿': '',
        'ðŸ™†': '',
        'ðŸ™†ðŸ»': '',
        'ðŸ™†ðŸ¼': '',
        'ðŸ™†ðŸ½': '',
        'ðŸ™†ðŸ¾': '',
        'ðŸ™†ðŸ¿': '',
        'ðŸ™‹': '',
        'ðŸ™‹ðŸ»': '',
        'ðŸ™‹ðŸ¼': '',
        'ðŸ™‹ðŸ½': '',
        'ðŸ™‹ðŸ¾': '',
        'ðŸ™‹ðŸ¿': '',
        'ðŸ™Ž': '',
        'ðŸ™ŽðŸ»': '',
        'ðŸ™ŽðŸ¼': '',
        'ðŸ™ŽðŸ½': '',
        'ðŸ™ŽðŸ¾': '',
        'ðŸ™ŽðŸ¿': '',
        'ðŸ™': '',
        'ðŸ™ðŸ»': '',
        'ðŸ™ðŸ¼': '',
        'ðŸ™ðŸ½': '',
        'ðŸ™ðŸ¾': '',
        'ðŸ™ðŸ¿': '',
        'ðŸ’†': '',
        'ðŸ’†ðŸ»': '',
        'ðŸ’†ðŸ¼': '',
        'ðŸ’†ðŸ½': '',
        'ðŸ’†ðŸ¾': '',
        'ðŸ’†ðŸ¿': '',
        'ðŸ’‡': '',
        'ðŸ’‡ðŸ»': '',
        'ðŸ’‡ðŸ¼': '',
        'ðŸ’‡ðŸ½': '',
        'ðŸ’‡ðŸ¾': '',
        'ðŸ’‡ðŸ¿': '',
        'ðŸ’‘': '',
        'ðŸ‘©â€â¤ï¸â€ðŸ‘©': '',
        'ðŸ‘¨â€â¤ï¸â€ðŸ‘¨': '',
        'ðŸ’': '',
        'ðŸ‘©â€â¤ï¸â€ðŸ’‹â€ðŸ‘©': '',
        'ðŸ‘¨â€â¤ï¸â€ðŸ’‹â€ðŸ‘¨': '',
        'ðŸ™Œ': '',
        'ðŸ™ŒðŸ»': '',
        'ðŸ™ŒðŸ¼': '',
        'ðŸ™ŒðŸ½': '',
        'ðŸ™ŒðŸ¾': '',
        'ðŸ™ŒðŸ¿': '',
        'ðŸ‘': '',
        'ðŸ‘ðŸ»': '',
        'ðŸ‘ðŸ¼': '',
        'ðŸ‘ðŸ½': '',
        'ðŸ‘ðŸ¾': '',
        'ðŸ‘ðŸ¿': '',
        'ðŸ‘‚': '',
        'ðŸ‘‚ðŸ»': '',
        'ðŸ‘‚ðŸ¼': '',
        'ðŸ‘‚ðŸ½': '',
        'ðŸ‘‚ðŸ¾': '',
        'ðŸ‘‚ðŸ¿': '',
        'ðŸ‘€': '',
        'ðŸ‘ƒ': '',
        'ðŸ‘ƒðŸ»': '',
        'ðŸ‘ƒðŸ¼': '',
        'ðŸ‘ƒðŸ½': '',
        'ðŸ‘ƒðŸ¾': '',
        'ðŸ‘ƒðŸ¿': '',
        'ðŸ‘„': '',
        'ðŸ’‹': '',
        'ðŸ‘…': '',
        'ðŸ’…': '',
        'ðŸ’…ðŸ»': '',
        'ðŸ’…ðŸ¼': '',
        'ðŸ’…ðŸ½': '',
        'ðŸ’…ðŸ¾': '',
        'ðŸ’…ðŸ¿': '',
        'ðŸ‘‹': '',
        'ðŸ‘‹ðŸ»': '',
        'ðŸ‘‹ðŸ¼': '',
        'ðŸ‘‹ðŸ½': '',
        'ðŸ‘‹ðŸ¾': '',
        'ðŸ‘‹ðŸ¿': '',
        'ðŸ‘': '',
        'ðŸ‘ðŸ»': '',
        'ðŸ‘ðŸ¼': '',
        'ðŸ‘ðŸ½': '',
        'ðŸ‘ðŸ¾': '',
        'ðŸ‘ðŸ¿': '',
        'ðŸ‘Ž': '',
        'ðŸ‘ŽðŸ»': '',
        'ðŸ‘ŽðŸ¼': '',
        'ðŸ‘ŽðŸ½': '',
        'ðŸ‘ŽðŸ¾': '',
        'ðŸ‘ŽðŸ¿': '',
        'â˜': '',
        'â˜ðŸ»': '',
        'â˜ðŸ¼': '',
        'â˜ðŸ½': '',
        'â˜ðŸ¾': '',
        'â˜ðŸ¿': '',
        'ðŸ‘†': '',
        'ðŸ‘†ðŸ»': '',
        'ðŸ‘†ðŸ¼': '',
        'ðŸ‘†ðŸ½': '',
        'ðŸ‘†ðŸ¾': '',
        'ðŸ‘†ðŸ¿': '',
        'ðŸ‘‡': '',
        'ðŸ‘‡ðŸ»': '',
        'ðŸ‘‡ðŸ¼': '',
        'ðŸ‘‡ðŸ½': '',
        'ðŸ‘‡ðŸ¾': '',
        'ðŸ‘‡ðŸ¿': '',
        'ðŸ‘ˆ': '',
        'ðŸ‘ˆðŸ»': '',
        'ðŸ‘ˆðŸ¼': '',
        'ðŸ‘ˆðŸ½': '',
        'ðŸ‘ˆðŸ¾': '',
        'ðŸ‘ˆðŸ¿': '',
        'ðŸ‘‰': '',
        'ðŸ‘‰ðŸ»': '',
        'ðŸ‘‰ðŸ¼': '',
        'ðŸ‘‰ðŸ½': '',
        'ðŸ‘‰ðŸ¾': '',
        'ðŸ‘‰ðŸ¿': '',
        'ðŸ‘Œ': '',
        'ðŸ‘ŒðŸ»': '',
        'ðŸ‘ŒðŸ¼': '',
        'ðŸ‘ŒðŸ½': '',
        'ðŸ‘ŒðŸ¾': '',
        'ðŸ‘ŒðŸ¿': '',
        'âœŒ': '',
        'âœŒðŸ»': '',
        'âœŒðŸ¼': '',
        'âœŒðŸ½': '',
        'âœŒðŸ¾': '',
        'âœŒðŸ¿': '',
        'ðŸ‘Š': '',
        'ðŸ‘ŠðŸ»': '',
        'ðŸ‘ŠðŸ¼': '',
        'ðŸ‘ŠðŸ½': '',
        'ðŸ‘ŠðŸ¾': '',
        'ðŸ‘ŠðŸ¿': '',
        'âœŠ': '',
        'âœŠðŸ»': '',
        'âœŠðŸ¼': '',
        'âœŠðŸ½': '',
        'âœŠðŸ¾': '',
        'âœŠðŸ¿': '',
        'âœ‹': '',
        'âœ‹ðŸ»': '',
        'âœ‹ðŸ¼': '',
        'âœ‹ðŸ½': '',
        'âœ‹ðŸ¾': '',
        'âœ‹ðŸ¿': '',
        'ðŸ’ª': '',
        'ðŸ’ªðŸ»': '',
        'ðŸ’ªðŸ¼': '',
        'ðŸ’ªðŸ½': '',
        'ðŸ’ªðŸ¾': '',
        'ðŸ’ªðŸ¿': '',
        'ðŸ‘': '',
        'ðŸ‘ðŸ»': '',
        'ðŸ‘ðŸ¼': '',
        'ðŸ‘ðŸ½': '',
        'ðŸ‘ðŸ¾': '',
        'ðŸ‘ðŸ¿': '',
        'ðŸ™': '',
        'ðŸ™ðŸ»': '',
        'ðŸ™ðŸ¼': '',
        'ðŸ™ðŸ½': '',
        'ðŸ™ðŸ¾': '',
        'ðŸ™ðŸ¿': '',
        'ðŸŒ±': '',
        'ðŸŒ²': '',
        'ðŸŒ³': '',
        'ðŸŒ´': '',
        'ðŸŒµ': '',
        'ðŸŒ·': '',
        'ðŸŒ¸': '',
        'ðŸŒ¹': '',
        'ðŸŒº': '',
        'ðŸŒ»': '',
        'ðŸŒ¼': '',
        'ðŸ’': '',
        'ðŸŒ¾': '',
        'ðŸŒ¿': '',
        'ðŸ€': '',
        'ðŸ': '',
        'ðŸ‚': '',
        'ðŸƒ': '',
        'ðŸ„': '',
        'ðŸŒ°': '',
        'ðŸ€': '',
        'ðŸ': '',
        'ðŸ­': '',
        'ðŸ¹': '',
        'ðŸ‚': '',
        'ðŸƒ': '',
        'ðŸ„': '',
        'ðŸ®': '',
        'ðŸ…': '',
        'ðŸ†': '',
        'ðŸ¯': '',
        'ðŸ‡': '',
        'ðŸ°': '',
        'ðŸˆ': '',
        'ðŸ±': '',
        'ðŸŽ': '',
        'ðŸ´': '',
        'ðŸ': '',
        'ðŸ‘': '',
        'ðŸ': '',
        'ðŸ“': '',
        'ðŸ”': '',
        'ðŸ¤': '',
        'ðŸ£': '',
        'ðŸ¥': '',
        'ðŸ¦': '',
        'ðŸ§': '',
        'ðŸ˜': '',
        'ðŸª': '',
        'ðŸ«': '',
        'ðŸ—': '',
        'ðŸ–': '',
        'ðŸ·': '',
        'ðŸ½': '',
        'ðŸ•': '',
        'ðŸ©': '',
        'ðŸ¶': '',
        'ðŸº': '',
        'ðŸ»': '',
        'ðŸ¨': '',
        'ðŸ¼': '',
        'ðŸµ': '',
        'ðŸ™ˆ': '',
        'ðŸ™‰': '',
        'ðŸ™Š': '',
        'ðŸ’': '',
        'ðŸ‰': '',
        'ðŸ²': '',
        'ðŸŠ': '',
        'ðŸ': '',
        'ðŸ¢': '',
        'ðŸ¸': '',
        'ðŸ‹': '',
        'ðŸ³': '',
        'ðŸ¬': '',
        'ðŸ™': '',
        'ðŸŸ': '',
        'ðŸ ': '',
        'ðŸ¡': '',
        'ðŸš': '',
        'ðŸŒ': '',
        'ðŸ›': '',
        'ðŸœ': '',
        'ðŸ': '',
        'ðŸž': '',
        'ðŸ¾': '',
        'âš¡ï¸': '',
        'ðŸ”¥': '',
        'ðŸŒ™': '',
        'â˜€ï¸': '',
        'â›…ï¸': '',
        'â˜ï¸': '',
        'ðŸ’§': '',
        'ðŸ’¦': '',
        'â˜”ï¸': '',
        'ðŸ’¨': '',
        'â„ï¸': '',
        'ðŸŒŸ': '',
        'â­ï¸': '',
        'ðŸŒ ': '',
        'ðŸŒ„': '',
        'ðŸŒ…': '',
        'ðŸŒˆ': '',
        'ðŸŒŠ': '',
        'ðŸŒ‹': '',
        'ðŸŒŒ': '',
        'ðŸ—»': '',
        'ðŸ—¾': '',
        'ðŸŒ': '',
        'ðŸŒ': '',
        'ðŸŒŽ': '',
        'ðŸŒ': '',
        'ðŸŒ‘': '',
        'ðŸŒ’': '',
        'ðŸŒ“': '',
        'ðŸŒ”': '',
        'ðŸŒ•': '',
        'ðŸŒ–': '',
        'ðŸŒ—': '',
        'ðŸŒ˜': '',
        'ðŸŒš': '',
        'ðŸŒ': '',
        'ðŸŒ›': '',
        'ðŸŒœ': '',
        'ðŸŒž': '',
        'ðŸ…': '',
        'ðŸ†': '',
        'ðŸŒ½': '',
        'ðŸ ': '',
        'ðŸ‡': '',
        'ðŸˆ': '',
        'ðŸ‰': '',
        'ðŸŠ': '',
        'ðŸ‹': '',
        'ðŸŒ': '',
        'ðŸ': '',
        'ðŸŽ': '',
        'ðŸ': '',
        'ðŸ': '',
        'ðŸ‘': '',
        'ðŸ’': '',
        'ðŸ“': '',
        'ðŸ”': '',
        'ðŸ•': '',
        'ðŸ–': '',
        'ðŸ—': '',
        'ðŸ˜': '',
        'ðŸ™': '',
        'ðŸš': '',
        'ðŸ›': '',
        'ðŸœ': '',
        'ðŸ': '',
        'ðŸž': '',
        'ðŸŸ': '',
        'ðŸ¡': '',
        'ðŸ¢': '',
        'ðŸ£': '',
        'ðŸ¤': '',
        'ðŸ¥': '',
        'ðŸ¦': '',
        'ðŸ§': '',
        'ðŸ¨': '',
        'ðŸ©': '',
        'ðŸª': '',
        'ðŸ«': '',
        'ðŸ¬': '',
        'ðŸ­': '',
        'ðŸ®': '',
        'ðŸ¯': '',
        'ðŸ°': '',
        'ðŸ±': '',
        'ðŸ²': '',
        'ðŸ³': '',
        'ðŸ´': '',
        'ðŸµ': '',
        'â˜•': '',
        'ðŸ¶': '',
        'ðŸ·': '',
        'ðŸ¸': '',
        'ðŸ¹': '',
        'ðŸ¼': '',
        'ðŸŽ€': '',
        'ðŸŽ': '',
        'ðŸŽ‚': '',
        'ðŸŽƒ': '',
        'ðŸŽ„': '',
        'ðŸŽ‹': '',
        'ðŸŽ': '',
        'ðŸŽ‘': '',
        'ðŸŽ†': '',
        'ðŸŽ‡': '',
        'ðŸŽ‰': '',
        'ðŸŽŠ': '',
        'ðŸŽˆ': '',
        'ðŸ’«': '',
        'âœ¨': '',
        'ðŸ’¥': '',
        'ðŸŽ“': '',
        'ðŸ‘‘': '',
        'ðŸŽŽ': '',
        'ðŸŽ': '',
        'ðŸŽ': '',
        'ðŸŽŒ': '',
        'ðŸ®': '',
        'ðŸ’': '',
        'â¤ï¸': '',
        'ðŸ’”': '',
        'ðŸ’Œ': '',
        'ðŸ’•': '',
        'ðŸ’ž': '',
        'ðŸ’“': '',
        'ðŸ’—': '',
        'ðŸ’–': '',
        'ðŸ’˜': '',
        'ðŸ’': '',
        'ðŸ’Ÿ': '',
        'ðŸ’œ': '',
        'ðŸ’›': '',
        'ðŸ’š': '',
        'ðŸ’™': '',
        'ðŸƒ': '',
        'ðŸƒðŸ»': '',
        'ðŸƒðŸ¼': '',
        'ðŸƒðŸ½': '',
        'ðŸƒðŸ¾': '',
        'ðŸƒðŸ¿': '',
        'ðŸš¶': '',
        'ðŸš¶ðŸ»': '',
        'ðŸš¶ðŸ¼': '',
        'ðŸš¶ðŸ½': '',
        'ðŸš¶ðŸ¾': '',
        'ðŸš¶ðŸ¿': '',
        'ðŸ’ƒ': '',
        'ðŸ’ƒðŸ»': '',
        'ðŸ’ƒðŸ¼': '',
        'ðŸ’ƒðŸ½': '',
        'ðŸ’ƒðŸ¾': '',
        'ðŸ’ƒðŸ¿': '',
        'ðŸš£': '',
        'ðŸš£ðŸ»': '',
        'ðŸš£ðŸ¼': '',
        'ðŸš£ðŸ½': '',
        'ðŸš£ðŸ¾': '',
        'ðŸš£ðŸ¿': '',
        'ðŸŠ': '',
        'ðŸŠðŸ»': '',
        'ðŸŠðŸ¼': '',
        'ðŸŠðŸ½': '',
        'ðŸŠðŸ¾': '',
        'ðŸŠðŸ¿': '',
        'ðŸ„': '',
        'ðŸ„ðŸ»': '',
        'ðŸ„ðŸ¼': '',
        'ðŸ„ðŸ½': '',
        'ðŸ„ðŸ¾': '',
        'ðŸ„ðŸ¿': '',
        'ðŸ›€': '',
        'ðŸ›€ðŸ»': '',
        'ðŸ›€ðŸ¼': '',
        'ðŸ›€ðŸ½': '',
        'ðŸ›€ðŸ¾': '',
        'ðŸ›€ðŸ¿': '',
        'ðŸ‚': '',
        'ðŸŽ¿': '',
        'â›„ï¸': '',
        'ðŸš´': '',
        'ðŸš´ðŸ»': '',
        'ðŸš´ðŸ¼': '',
        'ðŸš´ðŸ½': '',
        'ðŸš´ðŸ¾': '',
        'ðŸš´ðŸ¿': '',
        'ðŸšµ': '',
        'ðŸšµðŸ»': '',
        'ðŸšµðŸ¼': '',
        'ðŸšµðŸ½': '',
        'ðŸšµðŸ¾': '',
        'ðŸšµðŸ¿': '',
        'ðŸ‡': '',
        'ðŸ‡ðŸ»': '',
        'ðŸ‡ðŸ¼': '',
        'ðŸ‡ðŸ½': '',
        'ðŸ‡ðŸ¾': '',
        'ðŸ‡ðŸ¿': '',
        'â›ºï¸': '',
        'ðŸŽ£': '',
        'âš½ï¸': '',
        'ðŸ€': '',
        'ðŸˆ': '',
        'âš¾ï¸': '',
        'ðŸŽ¾': '',
        'ðŸ‰': '',
        'â›³ï¸': '',
        'ðŸ†': '',
        'ðŸŽ½': '',
        'ðŸ': '',
        'ðŸŽ¹': '',
        'ðŸŽ¸': '',
        'ðŸŽ»': '',
        'ðŸŽ·': '',
        'ðŸŽº': '',
        'ðŸŽµ': '',
        'ðŸŽ¶': '',
        'ðŸŽ¼': '',
        'ðŸŽ§': '',
        'ðŸŽ¤': '',
        'ðŸŽ­': '',
        'ðŸŽ«': '',
        'ðŸŽ©': '',
        'ðŸŽª': '',
        'ðŸŽ¬': '',
        'ðŸŽ¨': '',
        'ðŸŽ¯': '',
        'ðŸŽ±': '',
        'ðŸŽ³': '',
        'ðŸŽ°': '',
        'ðŸŽ²': '',
        'ðŸŽ®': '',
        'ðŸŽ´': '',
        'ðŸƒ': '',
        'ðŸ€„ï¸': '',
        'ðŸŽ ': '',
        'ðŸŽ¡': '',
        'ðŸŽ¢': '',
        'ðŸšƒ': '',
        'ðŸšž': '',
        'ðŸš‚': '',
        'ðŸš‹': '',
        'ðŸš': '',
        'ðŸš„': '',
        'ðŸš…': '',
        'ðŸš†': '',
        'ðŸš‡': '',
        'ðŸšˆ': '',
        'ðŸš‰': '',
        'ðŸšŠ': '',
        'ðŸšŒ': '',
        'ðŸš': '',
        'ðŸšŽ': '',
        'ðŸš': '',
        'ðŸš‘': '',
        'ðŸš’': '',
        'ðŸš“': '',
        'ðŸš”': '',
        'ðŸš¨': '',
        'ðŸš•': '',
        'ðŸš–': '',
        'ðŸš—': '',
        'ðŸš˜': '',
        'ðŸš™': '',
        'ðŸšš': '',
        'ðŸš›': '',
        'ðŸšœ': '',
        'ðŸš²': '',
        'ðŸš': '',
        'â›½ï¸': '',
        'ðŸš§': '',
        'ðŸš¦': '',
        'ðŸš¥': '',
        'ðŸš€': '',
        'ðŸš': '',
        'âœˆï¸': '',
        'ðŸ’º': '',
        'âš“ï¸': '',
        'ðŸš¢': '',
        'ðŸš¤': '',
        'â›µï¸': '',
        'ðŸš¡': '',
        'ðŸš ': '',
        'ðŸšŸ': '',
        'ðŸ›‚': '',
        'ðŸ›ƒ': '',
        'ðŸ›„': '',
        'ðŸ›…': '',
        'ðŸ’´': '',
        'ðŸ’¶': '',
        'ðŸ’·': '',
        'ðŸ’µ': '',
        'ðŸ—½': '',
        'ðŸ—¿': '',
        'ðŸŒ': '',
        'ðŸ—¼': '',
        'â›²ï¸': '',
        'ðŸ°': '',
        'ðŸ¯': '',
        'ðŸŒ‡': '',
        'ðŸŒ†': '',
        'ðŸŒƒ': '',
        'ðŸŒ‰': '',
        'ðŸ ': '',
        'ðŸ¡': '',
        'ðŸ¢': '',
        'ðŸ¬': '',
        'ðŸ­': '',
        'ðŸ£': '',
        'ðŸ¤': '',
        'ðŸ¥': '',
        'ðŸ¦': '',
        'ðŸ¨': '',
        'ðŸ©': '',
        'ðŸ’’': '',
        'â›ªï¸': '',
        'ðŸª': '',
        'ðŸ«': '',
        'ðŸ‡¦ðŸ‡º': '',
        'ðŸ‡¦ðŸ‡¹': '',
        'ðŸ‡§ðŸ‡ª': '',
        'ðŸ‡§ðŸ‡·': '',
        'ðŸ‡¨ðŸ‡¦': '',
        'ðŸ‡¨ðŸ‡±': '',
        'ðŸ‡¨ðŸ‡³': '',
        'ðŸ‡¨ðŸ‡´': '',
        'ðŸ‡©ðŸ‡°': '',
        'ðŸ‡«ðŸ‡®': '',
        'ðŸ‡«ðŸ‡·': '',
        'ðŸ‡©ðŸ‡ª': '',
        'ðŸ‡­ðŸ‡°': '',
        'ðŸ‡®ðŸ‡³': '',
        'ðŸ‡®ðŸ‡©': '',
        'ðŸ‡®ðŸ‡ª': '',
        'ðŸ‡®ðŸ‡±': '',
        'ðŸ‡®ðŸ‡¹': '',
        'ðŸ‡¯ðŸ‡µ': '',
        'ðŸ‡°ðŸ‡·': '',
        'ðŸ‡²ðŸ‡´': '',
        'ðŸ‡²ðŸ‡¾': '',
        'ðŸ‡²ðŸ‡½': '',
        'ðŸ‡³ðŸ‡±': '',
        'ðŸ‡³ðŸ‡¿': '',
        'ðŸ‡³ðŸ‡´': '',
        'ðŸ‡µðŸ‡­': '',
        'ðŸ‡µðŸ‡±': '',
        'ðŸ‡µðŸ‡¹': '',
        'ðŸ‡µðŸ‡·': '',
        'ðŸ‡·ðŸ‡º': '',
        'ðŸ‡¸ðŸ‡¦': '',
        'ðŸ‡¸ðŸ‡¬': '',
        'ðŸ‡¿ðŸ‡¦': '',
        'ðŸ‡ªðŸ‡¸': '',
        'ðŸ‡¸ðŸ‡ª': '',
        'ðŸ‡¨ðŸ‡­': '',
        'ðŸ‡¹ðŸ‡·': '',
        'ðŸ‡¬ðŸ‡§': '',
        'ðŸ‡ºðŸ‡¸': '',
        'ðŸ‡¦ðŸ‡ª': '',
        'ðŸ‡»ðŸ‡³': '',
        'âŒšï¸': '',
        'ðŸ“±': '',
        'ðŸ“²': '',
        'ðŸ’»': '',
        'â°': '',
        'â³': '',
        'âŒ›ï¸': '',
        'ðŸ“·': '',
        'ðŸ“¹': '',
        'ðŸŽ¥': '',
        'ðŸ“º': '',
        'ðŸ“»': '',
        'ðŸ“Ÿ': '',
        'ðŸ“ž': '',
        'â˜Žï¸': '',
        'ðŸ“ ': '',
        'ðŸ’½': '',
        'ðŸ’¾': '',
        'ðŸ’¿': '',
        'ðŸ“€': '',
        'ðŸ“¼': '',
        'ðŸ”‹': '',
        'ðŸ”Œ': '',
        'ðŸ’¡': '',
        'ðŸ”¦': '',
        'ðŸ“¡': '',
        'ðŸ’³': '',
        'ðŸ’¸': '',
        'ðŸ’°': '',
        'ðŸ’Ž': '',
        'ðŸŒ‚': '',
        'ðŸ‘': '',
        'ðŸ‘›': '',
        'ðŸ‘œ': '',
        'ðŸ’¼': '',
        'ðŸŽ’': '',
        'ðŸ’„': '',
        'ðŸ‘“': '',
        'ðŸ‘’': '',
        'ðŸ‘¡': '',
        'ðŸ‘ ': '',
        'ðŸ‘¢': '',
        'ðŸ‘ž': '',
        'ðŸ‘Ÿ': '',
        'ðŸ‘™': '',
        'ðŸ‘—': '',
        'ðŸ‘˜': '',
        'ðŸ‘š': '',
        'ðŸ‘•': '',
        'ðŸ‘”': '',
        'ðŸ‘–': '',
        'ðŸšª': '',
        'ðŸš¿': '',
        'ðŸ›': '',
        'ðŸš½': '',
        'ðŸ’ˆ': '',
        'ðŸ’‰': '',
        'ðŸ’Š': '',
        'ðŸ”¬': '',
        'ðŸ”­': '',
        'ðŸ”®': '',
        'ðŸ”§': '',
        'ðŸ”ª': '',
        'ðŸ”©': '',
        'ðŸ”¨': '',
        'ðŸ’£': '',
        'ðŸš¬': '',
        'ðŸ”«': '',
        'ðŸ”–': '',
        'ðŸ“°': '',
        'ðŸ”‘': '',
        'âœ‰ï¸': '',
        'ðŸ“©': '',
        'ðŸ“¨': '',
        'ðŸ“§': '',
        'ðŸ“¥': '',
        'ðŸ“¤': '',
        'ðŸ“¦': '',
        'ðŸ“¯': '',
        'ðŸ“®': '',
        'ðŸ“ª': '',
        'ðŸ“«': '',
        'ðŸ“¬': '',
        'ðŸ“­': '',
        'ðŸ“„': '',
        'ðŸ“ƒ': '',
        'ðŸ“‘': '',
        'ðŸ“ˆ': '',
        'ðŸ“‰': '',
        'ðŸ“Š': '',
        'ðŸ“…': '',
        'ðŸ“†': '',
        'ðŸ”…': '',
        'ðŸ”†': '',
        'ðŸ“œ': '',
        'ðŸ“‹': '',
        'ðŸ“–': '',
        'ðŸ““': '',
        'ðŸ“”': '',
        'ðŸ“’': '',
        'ðŸ“•': '',
        'ðŸ“—': '',
        'ðŸ“˜': '',
        'ðŸ“™': '',
        'ðŸ“š': '',
        'ðŸ“‡': '',
        'ðŸ”—': '',
        'ðŸ“Ž': '',
        'ðŸ“Œ': '',
        'âœ‚ï¸': '',
        'ðŸ“': '',
        'ðŸ“': '',
        'ðŸ“': '',
        'ðŸš©': '',
        'ðŸ“': '',
        'ðŸ“‚': '',
        'âœ’ï¸': '',
        'âœï¸': '',
        'ðŸ“': '',
        'ðŸ”': '',
        'ðŸ”': '',
        'ðŸ”’': '',
        'ðŸ”“': '',
        'ðŸ“£': '',
        'ðŸ“¢': '',
        'ðŸ”ˆ': '',
        'ðŸ”‰': '',
        'ðŸ”Š': '',
        'ðŸ”‡': '',
        'ðŸ’¤': '',
        'ðŸ””': '',
        'ðŸ”•': '',
        'ðŸ’­': '',
        'ðŸ’¬': '',
        'ðŸš¸': '',
        'ðŸ”': '',
        'ðŸ”Ž': '',
        'ðŸš«': '',
        'â›”ï¸': '',
        'ðŸ“›': '',
        'ðŸš·': '',
        'ðŸš¯': '',
        'ðŸš³': '',
        'ðŸš±': '',
        'ðŸ“µ': '',
        'ðŸ”ž': '',
        'ðŸ‰‘': '',
        'ðŸ‰': '',
        'ðŸ’®': '',
        'ãŠ™ï¸': '',
        'ãŠ—ï¸': '',
        'ðŸˆ´': '',
        'ðŸˆµ': '',
        'ðŸˆ²': '',
        'ðŸˆ¶': '',
        'ðŸˆšï¸': '',
        'ðŸˆ¸': '',
        'ðŸˆº': '',
        'ðŸˆ·': '',
        'ðŸˆ¹': '',
        'ðŸˆ³': '',
        'ðŸˆ‚': '',
        'ðŸˆ': '',
        'ðŸˆ¯ï¸': '',
        'ðŸ’¹': '',
        'â‡ï¸': '',
        'âœ³ï¸': '',
        'âŽ': '',
        'âœ…': '',
        'âœ´ï¸': '',
        'ðŸ“³': '',
        'ðŸ“´': '',
        'ðŸ†š': '',
        'ðŸ…°': '',
        'ðŸ…±': '',
        'ðŸ†Ž': '',
        'ðŸ†‘': '',
        'ðŸ…¾': '',
        'ðŸ†˜': '',
        'ðŸ†”': '',
        'ðŸ…¿ï¸': '',
        'ðŸš¾': '',
        'ðŸ†’': '',
        'ðŸ†“': '',
        'ðŸ†•': '',
        'ðŸ†–': '',
        'ðŸ†—': '',
        'ðŸ†™': '',
        'ðŸ§': '',
        'â™ˆï¸': '',
        'â™‰ï¸': '',
        'â™Šï¸': '',
        'â™‹ï¸': '',
        'â™Œï¸': '',
        'â™ï¸': '',
        'â™Žï¸': '',
        'â™ï¸': '',
        'â™ï¸': '',
        'â™‘ï¸': '',
        'â™’ï¸': '',
        'â™“ï¸': '',
        'ðŸš»': '',
        'ðŸš¹': '',
        'ðŸšº': '',
        'ðŸš¼': '',
        'â™¿ï¸': '',
        'ðŸš°': '',
        'ðŸš­': '',
        'ðŸš®': '',
        'â–¶ï¸': '',
        'â—€ï¸': '',
        'ðŸ”¼': '',
        'ðŸ”½': '',
        'â©': '',
        'âª': '',
        'â«': '',
        'â¬': '',
        'âž¡ï¸': '',
        'â¬…ï¸': '',
        'â¬†ï¸': '',
        'â¬‡ï¸': '',
        'â†—ï¸': '',
        'â†˜ï¸': '',
        'â†™ï¸': '',
        'â†–ï¸': '',
        'â†•ï¸': '',
        'â†”ï¸': '',
        'ðŸ”„': '',
        'â†ªï¸': '',
        'â†©ï¸': '',
        'â¤´ï¸': '',
        'â¤µï¸': '',
        'ðŸ”€': '',
        'ðŸ”': '',
        'ðŸ”‚': '',
        '#âƒ£': '',
        '0âƒ£': '',
        '1âƒ£': '',
        '2âƒ£': '',
        '3âƒ£': '',
        '4âƒ£': '',
        '5âƒ£': '',
        '6âƒ£': '',
        '7âƒ£': '',
        '8âƒ£': '',
        '9âƒ£': '',
        'ðŸ”Ÿ': '',
        'ðŸ”¢': '',
        'ðŸ”¤': '',
        'ðŸ”¡': '',
        'ðŸ” ': '',
        'â„¹ï¸': '',
        'ðŸ“¶': '',
        'ðŸŽ¦': '',
        'ðŸ”£': '',
        'âž•': '',
        'âž–': '',
        'ã€°': '',
        'âž—': '',
        'âœ–ï¸': '',
        'âœ”ï¸': '',
        'ðŸ”ƒ': '',
        'â„¢': '',
        'Â©': '',
        'Â®': '',
        'ðŸ’±': '',
        'ðŸ’²': '',
        'âž°': '',
        'âž¿': '',
        'ã€½ï¸': '',
        'â—ï¸': '',
        'â“': '',
        'â•': '',
        'â”': '',
        'â€¼ï¸': '',
        'â‰ï¸': '',
        'âŒ': '',
        'â­•ï¸': '',
        'ðŸ’¯': '',
        'ðŸ”š': '',
        'ðŸ”™': '',
        'ðŸ”›': '',
        'ðŸ”': '',
        'ðŸ”œ': '',
        'ðŸŒ€': '',
        'â“‚ï¸': '',
        'â›Ž': '',
        'ðŸ”¯': '',
        'ðŸ”°': '',
        'ðŸ”±': '',
        'âš ï¸': '',
        'â™¨ï¸': '',
        'â™»ï¸': '',
        'ðŸ’¢': '',
        'ðŸ’ ': '',
        'â™ ï¸': '',
        'â™£ï¸': '',
        'â™¥ï¸': ''
    };

    headers = new HttpHeaders()
        .append('ignoreLoadingBar', '');

    constructor(private http: HttpClient) {
    }

    /**
     * Send user messages to the chatbot API.
     *
     * Also used for the start_conversation trigger message
     *
     * @param message (message user has typed)
     */
    sendMessage(message) {
        if (message !== '') {
            if (message !== 'start_conversation') {
                this.messagesArray.push({
                    type: 'user',
                    messages: [{message: message}],
                    timestamp: new Date(Date.now()).toISOString()
                });
                this.messages.next(this.messagesArray);
            }

            this.http.post(this.apiUrl + '/chats/' + this.chatbotId + '/message?access_token=' + this.accessToken, {
                'message': message,
                'environment': 'production',
                'session': this.session,
                'locale': 'en'
            }, {headers: this.headers}).toPromise();
        }
    }

    /**
     * Get response message from api
     *
     * @param date (date of when you want to retrieve the response message)
     */
    getMessages(date) {
        // http call to oswald api
        return this.http.get(this.apiUrl + '/chats/' + this.chatbotId + '/session/' + this.session + '/latest/' + date, {headers: this.headers})
            .toPromise()
            .then(data => {
                if (data[0]) {
                    return this.processData(data[0]);
                }
            });
    }

    /**
     * Get all messages from the chatbot API that were send after a specific date.
     *
     * @param date (date of when you want to retrieve messages)
     */
    getSessionMessages(date) {
        // http call to oswald api
        return this.http.get(this.apiUrl + '/chats/' + this.chatbotId + '/session/' + this.session + '/latest/' + date, {headers: this.headers})
            .toPromise()
            .then(data => {
                if (data[0]) {
                    return this.processSessionData(data);
                }
            });
    }

    /**
     * Set up a chat stream to retrieve messages that are send by the user and bot.
     *
     * @param dateTime (date of when you want to retrieve messages)
     * @param stop (true = start chat stream, false = stop chat stream)
     */
    openChatStream(dateTime, stop) {
        let date = dateTime;
        if (stop === true) {
            clearInterval(this.intervalId);
        } else {
            clearInterval(this.intervalId);
            this.intervalId = setInterval(() => {
                this.getMessages(date).then(data => {
                    if (data) {
                        date = data;
                    }
                });
            }, 1000);
        }
    }

    /**
     * Stop current chat stream.
     */
    closeChatStream() {
        // set current datetime
        const date = new Date(Date.now());

        // clear interval
        this.openChatStream(date, true);
    }

    /**
     * process the data that comes from the data stream.
     *
     * @param response (response of the data stream)
     */
    processData(response) {
        const messages = [];
        const quickReplies = [];
        let senderType;

        // set sender type
        if (response['type'] === 'out') {
            senderType = 'chatbot';
        } else if (response['type'] === 'takeover') {
            senderType = 'takeover';
        }

        // loading messages
        for (let i = 0; i < response['data'].length; i++) {
            switch (response['data'][i]['type']) {
                case 'text':
                    messages.push({type: 'text', message: response['data'][i]['message']});
                    break;
                case 'url':
                    messages.push({
                        type: 'url',
                        message: response['data'][i]['message'],
                        url: response['data'][i]['url']
                    });
                    break;
                case 'image':
                    messages.push({type: 'image', image: response['data'][i]['image']});
                    break;
            }
        }

        // loading quick replies
        if (response['quickReplies']) {
            for (let i = 0; i < response['quickReplies'].length; i++) {
                quickReplies.push({
                    text: response['quickReplies'][i]['text'],
                    action: response['quickReplies'][i]['action']
                });
            }
        }

        // put messagesArray in behaviorsubject
        this.messagesArray.push({
            type: senderType,
            messages: messages,
            quickReplies: quickReplies,
            timestamp: response['createdAt']
        });

        this.messages.next(this.messagesArray);

        return response['createdAt'];
    }

    /**
     * process the session data
     *
     * @param response (response of the data stream)
     */
    processSessionData(response) {
        for (let j = 0; j < response.length; j++) {
            const messages = [];
            const quickReplies = [];
            let senderType;

            // set sender type
            if (response[j]['type'] === 'out') {
                senderType = 'chatbot';
            } else if (response[j]['type'] === 'takeover') {
                senderType = 'takeover';
            }

            // load question
            if (response[j]['metadata']) {
                if (response[j]['metadata']['sentence'] !== 'start_conversation') {
                    this.messagesArray.push({
                        type: 'user',
                        messages: [{message: response[j]['metadata']['sentence']}],
                        timestamp: response[j]['createdAt']
                    });
                }
            }

            // loading messages
            for (let i = 0; i < response[j]['data'].length; i++) {
                switch (response[j]['data'][i]['type']) {
                    case 'text':
                        messages.push({type: 'text', message: response[j]['data'][i]['message']});
                        break;
                    case 'url':
                        messages.push({
                            type: 'url',
                            message: response[j]['data'][i]['message'],
                            url: response[j]['data'][i]['url']
                        });
                        break;
                    case 'image':
                        messages.push({type: 'image', image: response[j]['data'][i]['image']});
                        break;
                }
            }

            // loading quick replies
            if (response[j]['quickReplies']) {
                for (let i = 0; i < response[j]['quickReplies'].length; i++) {
                    quickReplies.push({
                        text: response[j]['quickReplies'][i]['text'],
                        action: response[j]['quickReplies'][i]['action']
                    });
                }
            }

            // put messagesArray in behaviorsubject
            this.messagesArray.push({
                type: senderType,
                messages: messages,
                quickReplies: quickReplies,
                timestamp: response[j]['createdAt']
            });
        }

        this.messages.next(this.messagesArray);

        if (response[response.length - 1]) {
            return response[response.length - 1]['createdAt'];
        }
    }

    /**
     * Get all the messages of your current session.
     * Is triggered when messagesArray is empty, but the session still exists.
     */
    getSession() {
        const sessionObject = JSON.parse(sessionStorage.getItem('chatbotSession'));

        if (this.messagesArray.length <= 0) {
            // get previous messages of session
            this.processSessionData(this.getSessionMessages(sessionObject.timestamp));
        }
    }

    /**
     * Sets the session when opening the chatbot.
     *
     * If a sessionId is detected in sessionStorage, that sessionId is used.
     * If the sessionStorage lacks a sessionId, a new session is created.
     */
    setSession() {
        const sessionObject = JSON.parse(sessionStorage.getItem('chatbotSession'));

        // set up new sessionId if it doesn't exist
        if (sessionObject !== null) {
            // set sessionId
            this.session = sessionObject.sessionId;

            // open stream
            this.openChatStream(new Date(Date.now()).toISOString(), false);

            return false;
        } else {
            const date = new Date(Date.now());
            date.setSeconds(date.getSeconds() - 10);

            this.newSession(date);

            // open stream
            this.openChatStream(date.toISOString(), false);

            return true;
        }
    }

    /**
     * Make new session when there is no sessionId in sessionStorage.
     *
     * @param date (current date)
     */
    newSession(date) {
        // clear messages when new session
        this.messagesArray = [];
        this.messages.next(null);

        // set new session
        const sessionId = Guid.create();
        this.session = sessionId['value'];
        sessionStorage.setItem('chatbotSession', JSON.stringify({sessionId: this.session, timestamp: date}));

        // wake up chatbot
        this.sendMessage('start_conversation');
    }
}
